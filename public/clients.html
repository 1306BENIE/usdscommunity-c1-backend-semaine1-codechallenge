<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestion des Clients - Liste</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main>
      <div class="container">
        <section class="clients-section">
          <h2>Gestion des Clients</h2>

          <!-- Formulaire d'ajout de client -->
          <div class="form-section">
            <h3>Ajouter un nouveau client</h3>
            <form id="addClientForm" class="client-form">
              <div class="form-group">
                <label for="name">Nom *</label>
                <div class="input-wrapper">
                  <span class="input-icon" aria-hidden="true">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v2h20v-2c0-3.3-6.7-5-10-5z"
                        fill="#00d4ff"
                      />
                    </svg>
                  </span>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    placeholder="Nom du client"
                    aria-label="Nom du client"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="email">Email *</label>
                <div class="input-wrapper">
                  <span class="input-icon" aria-hidden="true">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm0 2v.01L12 13 20 6.01V6H4zm0 2.24V18h16V8.24l-8 7-8-7z"
                        fill="#00d4ff"
                      />
                    </svg>
                  </span>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    placeholder="Adresse email"
                    aria-label="Adresse email"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="phone">Téléphone</label>
                <div class="input-wrapper">
                  <span class="input-icon" aria-hidden="true">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.49 2.53.76 3.88.76a1 1 0 011 1V20a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.27 2.67.76 3.88a1 1 0 01-.21 1.11l-2.2 2.2z"
                        fill="#00d4ff"
                      />
                    </svg>
                  </span>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    placeholder="Numéro de téléphone"
                    aria-label="Numéro de téléphone"
                  />
                </div>
              </div>
              <button type="submit" class="btn btn-primary btn-add-client">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                    <path
                      d="M12 5v14m7-7H5"
                      stroke="#0f0f23"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                </span>
                <span>Ajouter le client</span>
              </button>
              <div id="formFeedback" aria-live="polite"></div>
            </form>
          </div>

          <!-- Liste des clients -->
          <div class="clients-list-section">
            <h3>Liste des clients</h3>
            <div id="clientsList" class="clients-list">
              <p class="loading">Chargement des clients...</p>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script>
      // Fonction pour charger la liste des clients
      async function loadClients() {
        try {
          const response = await fetch("/api/clients");
          const clients = await response.json();
          displayClients(clients);
        } catch (error) {
          console.error("Erreur lors du chargement des clients:", error);
          document.getElementById("clientsList").innerHTML =
            '<p class="error">Erreur lors du chargement des clients</p>';
        }
      }

      // Fonction pour afficher les clients
      function displayClients(clients) {
        const clientsList = document.getElementById("clientsList");

        if (clients.length === 0) {
          clientsList.innerHTML =
            '<p class="no-clients">Aucun client enregistré</p>';
          return;
        }

        const clientsHTML = clients
          .map(
            (client) => `
                <div class="client-card-premium" data-id="${client.id}">
                  <div class="client-card-header">
                    <div class="client-avatar" aria-hidden="true">
                      <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="12" fill="#00d4ff"/><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v2h20v-2c0-3.3-6.7-5-10-5z" fill="#fff"/></svg>
                    </div>
                    <div class="client-main-info">
                      <h4 class="client-name">${client.name}</h4>
                    </div>
                    <button class="btn btn-danger delete-btn-premium" onclick="deleteClient(${
                      client.id
                    })" aria-label="Supprimer ${client.name}">
                      <span class="delete-icon" aria-hidden="true">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 7h12M9 7V5a3 3 0 0 1 6 0v2m2 0v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7h12z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                      </span>
                      <span>Supprimer</span>
                    </button>
                  </div>
                  <div class="client-card-body">
                    <div class="client-info-line">
                      <span class="client-info-icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm0 2v.01L12 13 20 6.01V6H4zm0 2.24V18h16V8.24l-8 7-8-7z" fill="#00d4ff"/></svg>
                      </span>
                      <span class="client-info-text">${client.email}</span>
                    </div>
                    ${
                      client.phone
                        ? `
                    <div class="client-info-line">
                      <span class="client-info-icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.49 2.53.76 3.88.76a1 1 0 011 1V20a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.27 2.67.76 3.88a1 1 0 01-.21 1.11l-2.2 2.2z" fill="#00d4ff"/></svg>
                      </span>
                      <span class="client-info-text">${client.phone}</span>
                    </div>
                    `
                        : ""
                    }
                    <span class="client-id-badge">ID: ${client.id}</span>
                  </div>
                </div>
            `
          )
          .join("");

        clientsList.innerHTML = clientsHTML;
      }

      // Fonction pour ajouter un client
      async function addClient(clientData) {
        try {
          const response = await fetch("/api/clients", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(clientData),
          });

          if (response.ok) {
            const newClient = await response.json();
            console.log("Client ajouté:", newClient);
            loadClients(); // Recharger la liste
            document.getElementById("addClientForm").reset();
            showMessage("Client ajouté avec succès!", "success");
          } else {
            const error = await response.json();
            showMessage(`Erreur: ${error.error}`, "error");
          }
        } catch (error) {
          console.error("Erreur lors de l'ajout du client:", error);
          showMessage("Erreur lors de l'ajout du client", "error");
        }
      }

      // Fonction pour supprimer un client
      async function deleteClient(clientId) {
        if (!confirm("Êtes-vous sûr de vouloir supprimer ce client ?")) {
          return;
        }

        try {
          const response = await fetch(`/api/clients/${clientId}`, {
            method: "DELETE",
          });

          if (response.ok) {
            console.log("Client supprimé avec succès");
            loadClients(); // Recharger la liste
            showMessage("Client supprimé avec succès!", "success");
          } else {
            const error = await response.json();
            showMessage(`Erreur: ${error.error}`, "error");
          }
        } catch (error) {
          console.error("Erreur lors de la suppression du client:", error);
          showMessage("Erreur lors de la suppression du client", "error");
        }
      }

      // Fonction pour afficher des messages
      function showMessage(message, type) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = message;

        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      // Gestionnaire du formulaire
      document
        .getElementById("addClientForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const clientData = {
            name: formData.get("name"),
            email: formData.get("email"),
            phone: formData.get("phone"),
          };

          addClient(clientData);
        });

      // Charger les clients au chargement de la page
      document.addEventListener("DOMContentLoaded", loadClients);
    </script>

    <script src="navbar.js"></script>
    <script src="footer.js"></script>
  </body>
</html>
